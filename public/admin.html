<!DOCTYPE html>
<html class="dark" lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理後台 - STU TechPlay 代理人服務</title>
    <!-- Firebase SDK for local development -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="auth-guard.js"></script>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&amp;display=swap"
        rel="stylesheet" />
    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 300, 'GRAD' 0, 'opsz' 24
        }
    </style>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "background-light": "#F9FAFB",
                        "background-dark": "#0A0E27",
                        "card-light": "#FFFFFF",
                        "card-dark": "#1A1F3A",
                        "border-light": "#E5E7EB",
                        "border-dark": "#2D3555",
                        "muted-light": "#6B7280",
                        "muted-dark": "#94A3B8",
                        "primary": {
                            light: "#A78BFA",
                            DEFAULT: "#8B5CF6",
                            dark: "#7C3AED",
                            foreground: "#FFFFFF"
                        },
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.5rem",
                        "lg": "0.75rem",
                        "xl": "1rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 25%, #667eea 50%, #764ba2 75%, #8b5cf6 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* 舊的 header 樣式已移除，改用 Tailwind CSS */
        /* 保留以下樣式以防其他地方使用 */
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 2;
        }

        .header-text {
            text-align: left;
            position: relative;
            z-index: 3;
        }

        .auth-section {
            display: flex;
            align-items: center;
            gap: 20px;
            position: relative;
            z-index: 3;
        }

        /* 用戶資訊樣式已由 Tailwind CSS 處理 */

        #loginSection {
            display: flex;
            align-items: center;
        }

        /* userInfo 響應式設計 */
        @media (max-width: 768px) {
            #userInfo {
                flex-direction: column;
                gap: 12px;
                padding: 16px;
                text-align: center;
            }

            #userInfo #userName {
                font-size: 0.9rem;
            }

            #userInfo .btn {
                width: 100%;
                padding: 12px;
            }
        }

        @media (max-width: 480px) {
            .auth-section {
                flex-direction: column;
                gap: 16px;
                align-items: stretch;
            }

            #userInfo {
                margin: 0 auto;
                max-width: 280px;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .header-text {
                text-align: center;
            }
        }

        /* .main-content 背景色由父元素 main 控制，無需單獨定義 */

        .tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid #f0f0f0;
        }

        .tab {
            padding: 15px 30px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .tab.active {
            border-bottom-color: #4facfe;
            color: #4facfe;
        }

        .tab:hover {
            background: #f8f9fa;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #94A3B8;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #2D3555;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: rgba(26, 31, 58, 0.6);
            color: #E5E7EB;
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: #6B7280;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #8B5CF6;
            background: rgba(26, 31, 58, 0.8);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-group small {
            color: #94A3B8;
            font-size: 12px;
            display: block;
            margin-top: 5px;
        }

        .btn {
            background: #8B5CF6;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .btn:hover {
            background: #7C3AED;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }

        .btn-primary {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: white;
            background: linear-gradient(to right, #6A66FF, #8986FF);
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary:hover {
            background: linear-gradient(to right, #5551d9, #6A66FF);
        }

        .btn-secondary {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: #D1D5DB;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid #2A2A3C;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
        }

        .btn-ghost {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: #A0A0B0;
            background: transparent;
            border: none;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-ghost:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .btn-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 2.25rem;
            height: 2.25rem;
            color: #A0A0B0;
            background: transparent;
            border: none;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-icon:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .record-card {
            display: grid;
            grid-template-columns: auto 1fr auto;
            align-items: center;
            gap: 1rem;
            border: 1px solid transparent;
            border-radius: 0.5rem;
            padding: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .record-card:hover {
            background: var(--card-dark);
            border-color: var(--border-dark);
        }

        .record-card-active {
            background: var(--card-dark);
            border-color: var(--primary-base);
            box-shadow: 0 0 15px rgba(106, 102, 255, 0.3);
        }

        .profile-tab-btn {
            position: relative;
            background: transparent;
            border: none;
            cursor: pointer;
        }

        .profile-tab-btn.active {
            color: #E5E7EB;
            border-bottom-color: var(--primary-base);
        }

        .profile-tab-content {
            display: none;
        }

        .profile-tab-content.active {
            display: flex;
        }

        .agent-card {
            background: rgba(26, 31, 58, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 0.75rem;
            padding: 0;
            margin-bottom: 1rem;
            border: 1px solid var(--border-dark);
            overflow: hidden;
            transition: all 0.3s ease;
            position: relative;
        }

        .agent-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(106, 102, 255, 0.2);
            border-color: var(--primary-base);
        }

        .agent-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-base) 0%, var(--primary-light) 100%);
        }

        .agent-header {
            display: flex;
            align-items: center;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.03);
            border-bottom: 1px solid var(--border-dark);
        }

        .agent-avatar-container {
            position: relative;
            margin-right: 0.75rem;
        }

        .agent-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--border-dark);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .agent-avatar:hover {
            transform: scale(1.05);
            border-color: var(--primary-base);
        }

        .agent-status {
            position: absolute;
            bottom: 6px;
            right: 6px;
            width: 16px;
            height: 16px;
            background: #10b981;
            border: 2px solid var(--card-dark);
            border-radius: 50%;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.3);
        }

        .agent-info {
            flex: 1;
            margin-right: 0.75rem;
        }

        .agent-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: #E5E7EB;
            margin-bottom: 0.25rem;
            line-height: 1.2;
        }

        .agent-title {
            font-size: 0.8rem;
            color: var(--muted-dark);
            margin-bottom: 0.125rem;
            font-weight: 500;
        }

        .agent-provider {
            font-size: 0.7rem;
            color: var(--primary-light);
            background: rgba(139, 92, 246, 0.2);
            padding: 0.125rem 0.5rem;
            border-radius: 0.5rem;
            display: inline-block;
            font-weight: 500;
        }

        .agent-actions {
            display: flex;
            gap: 0.5rem;
        }

        .agent-actions .btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            border: none;
            transition: all 0.3s ease;
            font-size: 0.8rem;
        }

        .agent-actions .btn:hover {
            transform: scale(1.1);
        }

        .agent-actions .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--muted-dark);
        }

        .agent-actions .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            color: #E5E7EB;
        }

        .agent-actions .btn-danger {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
        }

        .agent-actions .btn-danger:hover {
            background: rgba(239, 68, 68, 0.3);
            color: #ef4444;
        }

        .agent-content {
            padding: 1rem;
        }

        .agent-description {
            margin-bottom: 1rem;
        }

        .description-label {
            font-size: 0.8rem;
            color: var(--muted-dark);
            font-weight: 600;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .description-text {
            font-size: 0.9rem;
            color: #E5E7EB;
            line-height: 1.5;
            background: rgba(255, 255, 255, 0.05);
            padding: 0.75rem;
            border-radius: 0.5rem;
            border-left: 4px solid var(--primary-base);
        }

        .agent-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
        }

        .stat-item {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.05);
            padding: 0.5rem;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
            border: 1px solid var(--border-dark);
        }

        .stat-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
            border-color: var(--primary-base);
        }

        .stat-icon {
            font-size: 1.1rem;
            margin-right: 0.5rem;
        }

        .stat-info {
            flex: 1;
        }

        .stat-value {
            font-size: 1rem;
            font-weight: 700;
            color: #E5E7EB;
            line-height: 1;
        }

        .stat-label {
            font-size: 0.7rem;
            color: var(--muted-dark);
            margin-top: 0.125rem;
        }

        .agent-footer {
            background: rgba(255, 255, 255, 0.03);
            padding: 1rem;
            border-top: 1px solid var(--border-dark);
        }

        .embed-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.5rem;
            padding: 0.75rem;
            border: 1px solid var(--border-dark);
        }

        .embed-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .embed-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: #E5E7EB;
        }

        .copy-btn {
            background: var(--primary-base);
            color: white;
            border: none;
            padding: 0.375rem 0.75rem;
            border-radius: 0.5rem;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .copy-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        .embed-code {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-dark);
            border-radius: 0.5rem;
            padding: 0.75rem;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            color: #E5E7EB;
            line-height: 1.4;
            overflow-x: auto;
        }

        .embed-code code {
            background: none;
            padding: 0;
            color: inherit;
        }

        /* 人物誌卡片一行顯示樣式 */
        .profile-card {
            background: white;
            border-radius: 8px;
            padding: 0;
            margin-bottom: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            border: 1px solid rgba(0, 0, 0, 0.05);
            overflow: hidden;
            transition: all 0.3s ease;
            position: relative;
        }

        .profile-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .profile-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #28a745 0%, #20c997 100%);
        }

        .profile-content {
            display: flex;
            align-items: center;
            padding: 12px;
            gap: 16px;
        }

        .profile-info {
            flex: 1;
            min-width: 0;
        }

        .profile-title {
            font-size: 1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .profile-meta {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .profile-meta span {
            font-size: 0.7rem;
            color: #666;
            background: rgba(102, 126, 234, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            white-space: nowrap;
        }

        .profile-stats {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .profile-stats .stat-item {
            display: flex;
            align-items: center;
            gap: 4px;
            background: #f8f9fa;
            padding: 6px 8px;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .profile-stats .stat-item:hover {
            background: #e9ecef;
        }

        .profile-stats .stat-icon {
            font-size: 0.8rem;
        }

        .profile-stats .stat-value {
            font-size: 0.8rem;
            font-weight: 600;
            color: #333;
        }

        .profile-stats .stat-label {
            font-size: 0.7rem;
            color: #666;
        }

        .profile-actions {
            display: flex;
            gap: 4px;
        }

        .profile-actions .btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            border: none;
            transition: all 0.3s ease;
            font-size: 0.7rem;
        }

        .profile-actions .btn:hover {
            transform: scale(1.1);
        }

        .profile-actions .btn-secondary {
            background: #f8f9fa;
            color: #666;
        }

        .profile-actions .btn-secondary:hover {
            background: #e9ecef;
            color: #333;
        }

        .profile-actions .btn-danger {
            background: #fff5f5;
            color: #e53e3e;
        }

        .profile-actions .btn-danger:hover {
            background: #fed7d7;
            color: #c53030;
        }

        /* JSON 顯示區域樣式 */
        .profile-json {
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            background: #f8f9fa;
        }

        .json-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: #e9ecef;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .json-title {
            font-size: 0.8rem;
            font-weight: 600;
            color: #333;
        }

        .json-header .btn {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            border: none;
            background: #667eea;
            color: white;
            font-size: 0.7rem;
            transition: all 0.3s ease;
        }

        .json-header .btn:hover {
            background: #5a67d8;
            transform: scale(1.05);
        }

        .json-content {
            padding: 12px;
            max-height: 300px;
            overflow-y: auto;
        }

        .json-content pre {
            margin: 0;
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 0.75rem;
            line-height: 1.4;
            color: #333;
            overflow-x: auto;
        }

        .json-content code {
            background: none;
            padding: 0;
            color: inherit;
            font-family: inherit;
        }

        /* JSON 摘要區域樣式 */
        .profile-json-summary {
            position: absolute;
            bottom: 8px;
            right: 8px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            max-width: 200px;
            z-index: 10;
            opacity: 0.9;
            transition: all 0.3s ease;
        }

        .profile-json-summary:hover {
            opacity: 1;
            background: rgba(0, 0, 0, 0.9);
        }

        .json-summary-content {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .json-summary-label {
            font-weight: 600;
            color: #ffd700;
            font-size: 0.65rem;
        }

        .json-summary-text {
            font-size: 0.65rem;
            line-height: 1.2;
            word-break: break-all;
            color: #e0e0e0;
        }

        /* 已移除重複的樣式定義 - 使用上方統一的樣式（行 365-544） */

        .loading {
            text-align: center;
            padding: 40px;
            color: #94A3B8;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 28px;
            border-radius: 16px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
        }

        .stats-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            border-radius: 16px;
            pointer-events: none;
        }

        .stats-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.2);
        }

        .stats-card.pending-notifications {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            animation: pulse 2s infinite;
        }

        .stats-card.pending-knowledge-base {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        }


        .stats-card.total-notifications {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.8;
            }
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .stats-number {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 12px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 1;
        }

        .stats-label {
            font-size: 1.1rem;
            opacity: 0.9;
            font-weight: 500;
            letter-spacing: 0.5px;
            position: relative;
            z-index: 1;
        }

        /* 統計卡片樣式 - 統一風格 */
        .conversation-stats,
        .token-stats,
        .linebot-stats,
        .notification-stats {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .conversation-main,
        .token-main,
        .linebot-main,
        .notification-main {
            text-align: center;
        }

        .conversation-details,
        .token-details,
        .linebot-details,
        .notification-details {
            display: flex;
            justify-content: space-between;
            gap: 8px;
            padding-top: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .detail-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            flex: 1;
            padding: 12px 8px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .detail-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-1px);
        }

        /* 代理詳細統計樣式 */
        .agent-detailed-stats {
            margin-top: 1.25rem;
            padding: 1.25rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.75rem;
            border: 1px solid var(--border-dark);
        }

        .stats-section {
            margin-bottom: 1.25rem;
        }

        .stats-section:last-child {
            margin-bottom: 0;
        }

        .stats-section h4 {
            margin: 0 0 0.9375rem 0;
            color: #E5E7EB;
            font-size: 1rem;
            font-weight: 600;
            border-bottom: 1px solid var(--border-dark);
            padding-bottom: 0.5rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.75rem;
        }

        .agent-stat-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.5rem;
            padding: 0.75rem;
            text-align: center;
            border: 1px solid var(--border-dark);
            transition: all 0.2s ease;
        }

        .agent-stat-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--primary-base);
        }

        .agent-stat-item .stat-label {
            display: block;
            color: var(--muted-dark);
            font-size: 0.75rem;
            margin-bottom: 0.25rem;
            font-weight: 500;
        }

        .agent-stat-item .stat-value {
            display: block;
            color: #E5E7EB;
            font-size: 1.125rem;
            font-weight: bold;
        }

        /* 已移除重複的 loading 樣式 - 使用上方統一的樣式 */

        /* LINE Bot 分析樣式 */
        .analytics-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(26, 31, 58, 0.6);
            border-radius: 12px;
            border: 1px solid #2D3555;
            backdrop-filter: blur(10px);
        }

        .analytics-header h2 {
            margin: 0;
            color: #E5E7EB;
            font-size: 24px;
        }

        .agent-selector {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .agent-selector label {
            color: #94A3B8;
            font-weight: 500;
        }

        .agent-selector select {
            padding: 8px 12px;
            border: 1px solid #2D3555;
            border-radius: 6px;
            background: rgba(26, 31, 58, 0.6);
            color: #E5E7EB;
            font-size: 14px;
            min-width: 200px;
        }

        .agent-selector select:focus {
            outline: none;
            border-color: #8B5CF6;
        }

        .agent-selector select option {
            background: rgba(26, 31, 58, 0.9);
            color: #E5E7EB;
        }

        .analytics-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            align-items: start;
        }

        .linebot-stats-vertical {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .user-behavior-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .analytics-placeholder {
            grid-column: 1 / -1;
            text-align: center;
            padding: 60px 20px;
            color: #94A3B8 !important;
            font-size: 16px;
            background: rgba(26, 31, 58, 0.6);
            border-radius: 8px;
            border: 1px solid #2D3555;
            backdrop-filter: blur(10px);
        }

        .analytics-section {
            background: rgba(26, 31, 58, 0.6);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #2D3555;
            backdrop-filter: blur(10px);
        }

        .analytics-section h3 {
            margin: 0 0 20px 0;
            color: #E5E7EB;
            font-size: 18px;
            border-bottom: 2px solid #2D3555;
            padding-bottom: 10px;
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .analytics-item {
            background: rgba(26, 31, 58, 0.4);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border: 1px solid #2D3555;
        }

        .analytics-item .label {
            color: #94A3B8;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .analytics-item .value {
            color: #A78BFA;
            font-size: 24px;
            font-weight: bold;
        }

        .linebot-users-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: transparent;
            border-radius: 8px;
            overflow: hidden;
        }

        .linebot-users-table th,
        .linebot-users-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #2D3555;
        }

        .linebot-users-table th {
            background: rgba(26, 31, 58, 0.6);
            color: #E5E7EB;
            font-weight: 600;
        }

        .linebot-users-table td {
            color: #94A3B8;
        }

        .linebot-users-table tr:hover {
            background: rgba(139, 92, 246, 0.1);
        }

        @media (max-width: 768px) {
            .analytics-content {
                grid-template-columns: 1fr;
            }

            .analytics-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            .agent-selector {
                width: 100%;
            }

            .agent-selector select {
                width: 100%;
            }
        }

        .detail-label {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .detail-value {
            font-size: 1.4rem;
            font-weight: 700;
            color: #ffffff;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        /* 儀表板優化樣式 */
        .stats-icon {
            font-size: 2rem;
            margin-bottom: 8px;
            opacity: 0.8;
        }

        .dashboard-section {
            margin-top: 30px;
            padding: 20px;
            background: #333;
            opacity: 0.8;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        /* 已移除重複的 section-title 樣式 - 使用下方統一的深色主題樣式 */

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .quick-action-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 20px;
            color: #ffffff;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(10px);
        }

        .quick-action-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .action-icon {
            font-size: 1.8rem;
            margin-bottom: 4px;
        }

        .action-text {
            font-size: 0.9rem;
            font-weight: 500;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .status-card {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .status-card:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-1px);
        }

        .status-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .status-info {
            flex: 1;
        }

        .status-label {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 4px;
        }

        .status-value {
            font-size: 1rem;
            font-weight: 600;
            color: #ffffff;
        }

        /* 響應式設計 */
        @media (max-width: 768px) {
            .quick-actions {
                grid-template-columns: repeat(2, 1fr);
            }

            .status-grid {
                grid-template-columns: 1fr;
            }

            .dashboard-section {
                padding: 15px;
                margin-top: 20px;
            }
        }

        /* 測試代理樣式 */
        .test-container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .test-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .test-header h2 {
            color: #E5E7EB;
            margin-bottom: 10px;
        }

        .test-header p {
            color: #94A3B8;
            font-size: 1.1rem;
        }

        .test-setup {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            border: 2px solid #e0e0e0;
        }

        .agent-info-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .agent-info-card h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.3rem;
        }

        .agent-info-card p {
            color: #666;
            margin-bottom: 15px;
        }

        .agent-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .detail-item strong {
            color: #555;
            font-size: 0.9rem;
        }

        .detail-item span {
            color: #333;
            font-weight: 500;
        }

        .test-chat {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            border: 2px solid #e0e0e0;
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-header h3 {
            margin: 0;
            font-size: 1.3rem;
        }

        .chat-messages {
            height: 400px;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .welcome-message {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
        }

        .message {
            max-width: 80%;
            padding: 12px 18px;
            border-radius: 18px;
            word-wrap: break-word;
            line-height: 1.4;
        }

        .message.user {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }

        .message.assistant {
            background: white;
            color: #333;
            align-self: flex-start;
            border-bottom-left-radius: 5px;
            border: 1px solid #e0e0e0;
        }

        .chat-input-container {
            padding: 20px;
            border-top: 1px solid #e0e0e0;
            background: white;
        }

        .input-group {
            display: flex;
            gap: 10px;
        }

        .input-group input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            outline: none;
            font-size: 14px;
            transition: border-color 0.2s ease;
        }

        .input-group input:focus {
            border-color: #667eea;
        }

        .input-group button {
            padding: 12px 24px;
            border-radius: 25px;
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 0;
            color: #666;
            font-size: 14px;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dots span {
            width: 8px;
            height: 8px;
            background: #999;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {

            0%,
            60%,
            100% {
                transform: translateY(0);
            }

            30% {
                transform: translateY(-10px);
            }
        }

        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 12px 18px;
            border-radius: 18px;
            border: 1px solid #ffcdd2;
            align-self: flex-start;
            max-width: 80%;
        }

        @media (max-width: 768px) {
            .chat-messages {
                height: 300px;
            }

            .agent-details {
                grid-template-columns: 1fr;
            }

            .input-group {
                flex-direction: column;
            }
        }

        /* Widget 測試樣式 */
        .chat-actions {
            display: flex;
            gap: 10px;
        }

        .widget-test {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }

        .widget-test-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .widget-test-header h3 {
            color: #333;
            margin-bottom: 10px;
        }

        .widget-test-container {
            display: flex;
            gap: 20px;
        }

        .widget-test-info {
            flex: 1;
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .widget-test-info h4 {
            color: #333;
            margin-bottom: 15px;
        }

        .widget-test-info ul {
            margin: 15px 0;
            padding-left: 20px;
        }

        .widget-test-info li {
            margin: 8px 0;
            color: #666;
        }

        .widget-test-page {
            flex: 2;
            position: relative;
            background: white;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            overflow: hidden;
        }

        /* 人物誌分析樣式 */
        .profile-analysis {
            margin-top: 20px;
        }

        .profile-controls {
            display: flex;
            gap: 15px;
            align-items: end;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(26, 31, 58, 0.6);
            border-radius: 10px;
            border: 1px solid #2D3555;
            backdrop-filter: blur(10px);
        }

        .profile-controls .form-group {
            flex: 1;
            margin: 0;
        }

        .profile-controls .form-group label {
            margin-bottom: 5px;
            font-weight: 500;
            color: #94A3B8;
        }

        .profiles-list {
            display: grid;
            gap: 20px;
        }

        .profile-card {
            background: rgba(26, 31, 58, 0.6);
            border-radius: 12px;
            border: 1px solid #2D3555;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .profile-card:hover {
            box-shadow: 0 4px 16px rgba(139, 92, 246, 0.2);
            transform: translateY(-2px);
            border-color: rgba(139, 92, 246, 0.5);
        }

        .profile-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #2D3555;
        }

        .profile-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #E5E7EB;
        }

        .profile-meta {
            display: flex;
            gap: 15px;
            font-size: 0.9rem;
            color: #94A3B8;
        }

        .profile-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .profile-section {
            background: rgba(26, 31, 58, 0.4);
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid #8B5CF6;
        }

        .profile-section h4 {
            color: #E5E7EB;
            margin-bottom: 10px;
            font-size: 1rem;
            font-weight: 600;
        }

        .profile-section p {
            color: #94A3B8;
            line-height: 1.5;
            margin: 0;
        }

        .profile-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #2D3555;
        }

        .profile-actions .btn {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .profile-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 10px;
            background: rgba(26, 31, 58, 0.4);
            border-radius: 8px;
            min-width: 80px;
            border: 1px solid #2D3555;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: #A78BFA;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #94A3B8;
            margin-top: 2px;
        }

        .mock-website {
            padding: 20px;
            min-height: 400px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        .mock-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .mock-header h2 {
            color: #333;
            margin-bottom: 10px;
        }

        .mock-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .mock-content h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .mock-content p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .mock-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .feature {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .feature h4 {
            color: #333;
            margin-bottom: 8px;
        }

        .feature p {
            color: #666;
            font-size: 14px;
            margin: 0;
        }

        #widgetContainer {
            position: relative;
            z-index: 1000;
        }

        /* 確保 Widget 在管理後台中的樣式正確 */
        #widgetContainer .ai-convai-widget {
            position: relative !important;
            bottom: auto !important;
            right: auto !important;
            z-index: 1000 !important;
        }

        #widgetContainer .ai-convai-chat {
            position: absolute !important;
            bottom: 80px !important;
            right: 0 !important;
            z-index: 1001 !important;
        }

        /* 防止管理後台樣式影響 Widget */
        #widgetContainer * {
            box-sizing: border-box !important;
        }

        /* 確保 Widget 按鈕在測試環境中正確顯示 */
        #widgetContainer .ai-convai-button {
            position: relative !important;
            margin: 20px auto !important;
            display: block !important;
        }

        /* 知識庫管理樣式 */
        .knowledge-base-manager {
            border: 1px solid #2D3555;
            border-radius: 8px;
            padding: 15px;
            background: rgba(26, 31, 58, 0.4);
        }

        .knowledge-base-list {
            margin-bottom: 15px;
        }

        .knowledge-base-item {
            background: rgba(26, 31, 58, 0.6);
            border: 1px solid #2D3555;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 10px;
            position: relative;
            transition: all 0.3s ease;
        }

        .knowledge-base-item.collapsed {
            padding: 10px 15px;
        }

        .knowledge-base-item.collapsed .knowledge-base-content {
            display: none;
        }

        .knowledge-base-item.collapsed .knowledge-base-keywords {
            display: none;
        }

        .knowledge-base-item:last-child {
            margin-bottom: 0;
        }

        .knowledge-base-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            cursor: pointer;
            user-select: none;
        }

        .knowledge-base-header:hover {
            background: rgba(139, 92, 246, 0.1);
            border-radius: 4px;
            padding: 4px 8px;
            margin: -4px -8px 6px -8px;
        }

        .knowledge-base-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
        }

        .knowledge-base-toggle-icon {
            font-size: 12px;
            color: #94A3B8;
            transition: transform 0.3s ease;
        }

        .knowledge-base-item.collapsed .knowledge-base-toggle-icon {
            transform: rotate(-90deg);
        }

        .knowledge-base-title {
            font-weight: 600;
            color: #E5E7EB;
            margin: 0;
        }

        .knowledge-base-actions {
            display: flex;
            gap: 5px;
        }

        .knowledge-base-actions button {
            padding: 4px 8px;
            font-size: 12px;
            border-radius: 4px;
        }

        .knowledge-base-content {
            width: 100%;
            min-height: 80px;
            padding: 10px;
            border: 1px solid #2D3555;
            border-radius: 4px;
            font-size: 14px;
            resize: vertical;
            font-family: inherit;
            background: rgba(26, 31, 58, 0.6);
            color: #E5E7EB;
        }

        .knowledge-base-content:focus {
            outline: none;
            border-color: #8B5CF6;
            background: rgba(26, 31, 58, 0.8);
        }

        .knowledge-base-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .knowledge-base-actions .btn {
            padding: 8px 16px;
            font-size: 14px;
        }

        .conversation-selector {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #2D3555;
            border-radius: 4px;
            background: rgba(26, 31, 58, 0.6);
        }

        .conversation-item {
            padding: 10px;
            border-bottom: 1px solid #2D3555;
            cursor: pointer;
            transition: background 0.2s ease;
            color: #E5E7EB;
        }

        .conversation-item:hover {
            background: rgba(139, 92, 246, 0.1);
        }

        .conversation-item:last-child {
            border-bottom: none;
        }

        .conversation-preview {
            font-size: 12px;
            color: #94A3B8;
            margin-top: 5px;
        }

        /* 模態框樣式 */
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 8px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow: hidden;
        }

        .modal-header {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            color: #333;
        }

        .modal-header .close {
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            color: #999;
        }

        .modal-header .close:hover {
            color: #333;
        }

        .modal-body {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }

        /* 知識庫關鍵字管理樣式 - 優化版 */
        .knowledge-base-keywords {
            margin: 8px 0;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 6px;
            border: 1px solid #e9ecef;
            font-size: 0.9rem;
        }

        .keywords-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            flex-wrap: wrap;
            gap: 8px;
        }

        .keywords-header label {
            font-weight: 600;
            color: #495057;
            margin: 0;
            font-size: 0.85rem;
        }

        .keyword-input-group {
            display: flex;
            gap: 6px;
            align-items: center;
            flex: 1;
            min-width: 0;
        }

        .keyword-input-group input {
            padding: 4px 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 0.8rem;
            min-width: 120px;
            flex: 1;
        }

        .keywords-display {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 8px;
            max-height: 120px;
            overflow-y: auto;
            padding: 4px;
        }

        .keyword-tag {
            display: inline-flex;
            align-items: center;
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            padding: 3px 6px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
            gap: 4px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
        }

        .keyword-tag:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
        }

        .keyword-tag .keyword-remove {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: bold;
            padding: 0;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
            line-height: 1;
        }

        .keyword-tag .keyword-remove:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .no-keywords {
            color: #6c757d;
            font-style: italic;
            font-size: 0.8rem;
            padding: 8px;
            text-align: center;
            background: rgba(108, 117, 125, 0.1);
            border-radius: 4px;
        }

        .knowledge-base-actions {
            display: flex;
            gap: 6px;
            align-items: center;
        }

        .btn-sm {
            padding: 3px 6px;
            font-size: 0.75rem;
            border-radius: 4px;
            font-weight: 500;
        }

        .add-keyword-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .add-keyword-btn:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        /* 通知管理樣式 */
        .notification-analysis {
            margin-top: 20px;
        }

        .notification-controls {
            display: flex;
            gap: 15px;
            align-items: end;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(26, 31, 58, 0.6);
            border-radius: 10px;
            border: 1px solid #2D3555;
            backdrop-filter: blur(10px);
        }

        .notification-controls .form-group {
            flex: 1;
            margin: 0;
        }

        .notification-controls .form-group label {
            margin-bottom: 5px;
            font-weight: 500;
            color: #94A3B8;
        }

        .notifications-list {
            display: grid;
            gap: 20px;
        }

        .notification-card {
            background: rgba(26, 31, 58, 0.6);
            border-radius: 12px;
            border: 1px solid #2D3555;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .notification-card:hover {
            box-shadow: 0 4px 16px rgba(139, 92, 246, 0.2);
            transform: translateY(-2px);
            border-color: rgba(139, 92, 246, 0.5);
        }

        .notification-card.pending {
            border-left: 4px solid #FCD34D;
        }

        .notification-card.high-priority {
            border-left: 4px solid #F87171;
        }

        .notification-card.medium-priority {
            border-left: 4px solid #FB923C;
        }

        .notification-card.low-priority {
            border-left: 4px solid #34D399;
        }

        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #2D3555;
        }

        .notification-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #E5E7EB;
        }

        .notification-meta {
            display: flex;
            gap: 15px;
            font-size: 0.9rem;
            color: #94A3B8;
        }

        .notification-content {
            margin-bottom: 15px;
        }

        .notification-message {
            color: #94A3B8;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .notification-details {
            background: rgba(26, 31, 58, 0.4);
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            border: 1px solid #2D3555;
        }

        .notification-details h4 {
            color: #E5E7EB;
            margin-bottom: 10px;
            font-size: 1rem;
            font-weight: 600;
        }

        .notification-details p {
            color: #94A3B8;
            margin: 5px 0;
        }

        .notification-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #2D3555;
        }

        .notification-actions .btn {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .notification-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .notification-status.pending {
            background: rgba(252, 211, 77, 0.2);
            color: #FCD34D;
            border: 1px solid rgba(252, 211, 77, 0.3);
        }

        .notification-status.completed {
            background: rgba(52, 211, 153, 0.2);
            color: #34D399;
            border: 1px solid rgba(52, 211, 153, 0.3);
        }

        .notification-priority {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-left: 10px;
        }

        .notification-priority.high {
            background: rgba(248, 113, 113, 0.2);
            color: #F87171;
            border: 1px solid rgba(248, 113, 113, 0.3);
        }

        .notification-priority.medium {
            background: rgba(251, 146, 60, 0.2);
            color: #FB923C;
            border: 1px solid rgba(251, 146, 60, 0.3);
        }

        .notification-priority.low {
            background: rgba(52, 211, 153, 0.2);
            color: #34D399;
            border: 1px solid rgba(52, 211, 153, 0.3);
        }

        /* 知識庫編輯對話框樣式 */
        .notification-info {
            background: rgba(26, 31, 58, 0.4);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border-left: 4px solid #8B5CF6;
            border: 1px solid #2D3555;
        }

        .notification-info h4 {
            color: #E5E7EB;
            margin-bottom: 10px;
            font-size: 1rem;
            font-weight: 600;
        }

        .notification-info p {
            color: #94A3B8;
            margin: 5px 0;
            font-size: 0.9rem;
        }

        .modal-content .form-group {
            margin-bottom: 20px;
        }

        .modal-content .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }

        .modal-content .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #2D3555;
            border-radius: 4px;
            font-size: 14px;
            background: rgba(26, 31, 58, 0.6);
            color: #E5E7EB;
        }

        .modal-content .form-control:focus {
            outline: none;
            border-color: #8B5CF6;
            background: rgba(26, 31, 58, 0.8);
        }

        .modal-content textarea.form-control {
            resize: vertical;
            min-height: 120px;
        }

        /* 失敗對話樣式 */
        .failed-conversations-section {
            margin-top: 30px;
            padding: 20px;
            background: rgba(26, 31, 58, 0.6);
            border-radius: 12px;
            border: 1px solid #2D3555;
            backdrop-filter: blur(10px);
        }

        .section-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #2D3555;
        }

        .section-header h3 {
            color: #E5E7EB;
            margin-bottom: 8px;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .section-header p {
            color: #94A3B8;
            margin: 0;
            font-size: 0.95rem;
        }

        .failed-conversations-list {
            display: grid;
            gap: 15px;
        }

        .failed-conversation-card {
            background: rgba(26, 31, 58, 0.6);
            border-radius: 10px;
            border: 1px solid #2D3555;
            padding: 18px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            border-left: 4px solid #F87171;
            backdrop-filter: blur(10px);
        }

        .failed-conversation-card:hover {
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.2);
            transform: translateY(-1px);
            border-color: rgba(139, 92, 246, 0.5);
        }

        .failed-conversation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 1px solid #f0f0f0;
        }

        .failed-conversation-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
        }

        .failed-conversation-meta {
            display: flex;
            gap: 12px;
            font-size: 0.85rem;
            color: #666;
        }

        .failed-conversation-content {
            margin-bottom: 15px;
        }

        .failed-conversation-messages {
            max-height: 200px;
            overflow-y: auto;
            background: #f8f9fa;
            border-radius: 6px;
            padding: 12px;
            border: 1px solid #e9ecef;
        }

        .failed-message {
            margin-bottom: 8px;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .failed-message.user {
            background: #e3f2fd;
            color: #1565c0;
            margin-left: 20px;
        }

        .failed-message.assistant {
            background: #f3e5f5;
            color: #7b1fa2;
            margin-right: 20px;
        }

        .failed-conversation-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #f0f0f0;
        }

        .failed-conversation-actions .btn {
            padding: 6px 12px;
            font-size: 0.85rem;
        }

        .failed-conversation-reason {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 8px 12px;
            margin-bottom: 10px;
            font-size: 0.85rem;
            color: #856404;
        }

        .failed-conversation-stats {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
        }

        .failed-stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 6px;
            min-width: 60px;
        }

        .failed-stat-value {
            font-size: 1rem;
            font-weight: 600;
            color: #dc3545;
        }

        .failed-stat-label {
            font-size: 0.75rem;
            color: #666;
            margin-top: 2px;
        }

        /* Session 統計樣式 */
        .session-analytics-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 1px solid #e9ecef;
        }

        .session-analytics-list {
            display: grid;
            gap: 20px;
        }

        .session-analytics-card {
            background: white;
            border-radius: 12px;
            border: 1px solid #e9ecef;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .session-analytics-card:hover {
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .session-analytics-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        .session-analytics-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
        }

        .session-analytics-meta {
            display: flex;
            gap: 15px;
            font-size: 0.9rem;
            color: #666;
        }

        .session-analytics-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }


        /* 已移除重複的 analytics-section 子樣式 - 這些樣式應該使用深色主題版本 */
        .analytics-section h4 {
            color: #E5E7EB;
            margin-bottom: 10px;
            font-size: 1rem;
            font-weight: 600;
        }

        .analytics-section p {
            color: #94A3B8;
            line-height: 1.5;
            margin: 5px 0;
        }

        .analytics-section strong {
            color: #E5E7EB;
            font-weight: 600;
        }

        .device-info {
            border-left-color: #28a745;
        }

        .location-info {
            border-left-color: #ffc107;
        }

        .session-info {
            border-left-color: #17a2b8;
        }

        .analytics-stats {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .analytics-stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            min-width: 80px;
        }

        .analytics-stat-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: #4facfe;
        }

        .analytics-stat-label {
            font-size: 0.75rem;
            color: #666;
            margin-top: 2px;
        }

        .session-analytics-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #f0f0f0;
        }

        .session-analytics-actions .btn {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        /* 人物誌 Session 統計優化樣式 */
        .profile-session-stats-modal .modal-content {
            width: 95%;
            max-width: 1000px;
            max-height: 90vh;
            margin: 2% auto;
            border-radius: 15px;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .profile-session-stats-modal .modal-header {
            padding: 30px 35px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-bottom: none;
            position: relative;
            border-radius: 15px 15px 0 0;
        }

        .profile-session-stats-modal .modal-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.05) 100%);
            border-radius: 15px 15px 0 0;
            pointer-events: none;
        }

        .profile-session-stats-modal .modal-header h3 {
            margin: 0;
            color: white;
            font-size: 1.6rem;
            font-weight: 700;
            text-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .profile-session-stats-modal .modal-header h3::before {
            content: '📊';
            font-size: 1.8rem;
        }

        .profile-session-stats-modal .modal-header .close {
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            color: rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            position: relative;
            z-index: 1;
        }

        .profile-session-stats-modal .modal-header .close:hover {
            color: white;
            background: rgba(255, 255, 255, 0.25);
            transform: scale(1.1);
        }

        .profile-session-stats-modal .modal-body {
            padding: 35px;
            max-height: 80vh;
            overflow-y: auto;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }

        .profile-session-stats-modal .session-analytics-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        .profile-session-stats-modal .analytics-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .profile-session-stats-modal .analytics-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        }

        .profile-session-stats-modal .analytics-section:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        }

        .profile-session-stats-modal .analytics-section h4 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.2rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 12px;
            border-bottom: 2px solid #f0f0f0;
        }

        .profile-session-stats-modal .analytics-section p {
            color: #555;
            line-height: 1.6;
            margin: 12px 0;
            font-size: 0.95rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .profile-session-stats-modal .analytics-section strong {
            color: #333;
            font-weight: 600;
            min-width: 120px;
        }

        .profile-session-stats-modal .analytics-section span {
            color: #667eea;
            font-weight: 500;
            background: rgba(102, 126, 234, 0.1);
            padding: 4px 8px;
            border-radius: 4px;
            border-radius: 6px;
        }

        .profile-session-stats-modal .device-info::before {
            background: linear-gradient(90deg, #28a745 0%, #20c997 100%);
        }

        .profile-session-stats-modal .location-info::before {
            background: linear-gradient(90deg, #ffc107 0%, #fd7e14 100%);
        }

        .profile-session-stats-modal .session-info::before {
            background: linear-gradient(90deg, #17a2b8 0%, #6f42c1 100%);
        }

        /* 響應式設計 */
        @media (max-width: 768px) {
            .profile-session-stats-modal .modal-content {
                width: 98%;
                margin: 1% auto;
            }

            .profile-session-stats-modal .modal-header {
                padding: 20px;
            }

            .profile-session-stats-modal .modal-body {
                padding: 20px;
            }

            .profile-session-stats-modal .session-analytics-content {
                grid-template-columns: 1fr;
            }

            .profile-session-stats-modal .analytics-section p {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
        }

        /* 圖表分析儀表板樣式 */
        .analytics-dashboard {
            margin-top: 20px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: rgba(26, 31, 58, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 0.75rem;
            padding: 1.25rem;
            border: 1px solid var(--border-dark);
            transition: all 0.3s ease;
        }

        .chart-container:hover {
            box-shadow: 0 4px 16px rgba(106, 102, 255, 0.2);
            transform: translateY(-2px);
            border-color: var(--primary-base);
        }

        .chart-container h4 {
            color: #E5E7EB;
            margin-bottom: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-dark);
        }

        .chart-container canvas {
            max-height: 300px;
        }

        .analytics-summary {
            background: rgba(26, 31, 58, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-top: 1.5rem;
            border: 1px solid var(--border-dark);
        }

        .summary-loading {
            text-align: center;
            color: var(--muted-dark);
            font-size: 1rem;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .summary-stat-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.5rem;
            padding: 1rem;
            text-align: center;
            border: 1px solid var(--border-dark);
            transition: all 0.2s ease;
        }

        .summary-stat-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--primary-base);
        }

        .summary-stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: #E5E7EB;
        }

        .summary-stat-label {
            font-size: 0.875rem;
            color: var(--muted-dark);
            font-weight: 500;
        }

        /* 響應式設計 */
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .chart-container {
                padding: 15px;
            }

            .chart-container canvas {
                max-height: 250px;
            }

            .summary-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* 失敗對話詳情優化樣式 */
        .failed-conversation-details-modal .modal-content {
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            margin: 3% auto;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .failed-conversation-details-modal .modal-header {
            padding: 25px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-bottom: none;
            position: relative;
        }

        .failed-conversation-details-modal .modal-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            pointer-events: none;
        }

        .failed-conversation-details-modal .modal-header h3 {
            margin: 0;
            color: white;
            font-size: 1.4rem;
            font-weight: 600;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            position: relative;
            z-index: 1;
        }

        .failed-conversation-details-modal .modal-header .close {
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: rgba(255, 255, 255, 0.8);
            transition: all 0.2s ease;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            position: relative;
            z-index: 1;
        }

        .failed-conversation-details-modal .modal-header .close:hover {
            color: white;
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .failed-conversation-details-modal .modal-body {
            padding: 30px;
            max-height: 75vh;
            overflow-y: auto;
            background: #fafbfc;
        }

        .failed-conversation-details-modal .conversation-details {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid #dee2e6;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .failed-conversation-details-modal .conversation-details h4 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .failed-conversation-details-modal .conversation-details h4::before {
            content: '📊';
            font-size: 1.3rem;
        }

        .failed-conversation-details-modal .conversation-details p {
            margin: 10px 0;
            color: #555;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .failed-conversation-details-modal .conversation-details strong {
            color: #333;
            font-weight: 600;
        }

        .failed-conversation-details-modal .conversation-messages {
            background: white;
            border-radius: 10px;
            padding: 25px;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .failed-conversation-details-modal .conversation-messages h4 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .failed-conversation-details-modal .conversation-messages h4::before {
            content: '💬';
            font-size: 1.3rem;
        }

        .failed-conversation-details-modal .enhanced-failed-message {
            margin-bottom: 15px;
            padding: 15px 20px;
            border-radius: 10px;
            font-size: 0.95rem;
            line-height: 1.6;
            position: relative;
            border: 1px solid transparent;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
        }

        .failed-conversation-details-modal .enhanced-failed-message:hover {
            transform: translateX(3px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
        }

        .failed-conversation-details-modal .enhanced-failed-message.user {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            color: #1565c0;
            margin-left: 30px;
            border-left: 5px solid #2196f3;
        }

        .failed-conversation-details-modal .enhanced-failed-message.assistant {
            background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
            color: #7b1fa2;
            margin-right: 30px;
            border-left: 5px solid #9c27b0;
        }

        .failed-conversation-details-modal .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .failed-conversation-details-modal .message-role {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .failed-conversation-details-modal .message-role::before {
            content: '';
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: currentColor;
        }

        .failed-conversation-details-modal .message-timestamp {
            color: rgba(0, 0, 0, 0.6);
            font-weight: 400;
        }

        .failed-conversation-details-modal .message-content {
            word-wrap: break-word;
            white-space: pre-wrap;
        }

        .failed-conversation-details-modal .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 2px solid #e9ecef;
        }

        .failed-conversation-details-modal .action-buttons .btn {
            flex: 1;
            padding: 12px 20px;
            font-size: 0.95rem;
            font-weight: 500;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .failed-conversation-details-modal .action-buttons .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        /* 響應式設計 */
        @media (max-width: 768px) {
            .keywords-header {
                flex-direction: column;
                align-items: stretch;
            }

            .keyword-input-group {
                width: 100%;
            }

            .keyword-input-group input {
                flex: 1;
                min-width: auto;
            }

            .notification-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .notification-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .notification-actions {
                flex-direction: column;
            }

            .failed-conversation-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .failed-conversation-actions {
                flex-direction: column;
            }

            .failed-conversation-stats {
                flex-wrap: wrap;
            }

            .failed-conversation-details-modal .enhanced-failed-message.user,
            .failed-conversation-details-modal .enhanced-failed-message.assistant {
                margin-left: 0;
                margin-right: 0;
            }

            .failed-conversation-details-modal .action-buttons {
                flex-direction: column;
            }

            .failed-conversation-details-modal .modal-content {
                width: 98%;
                margin: 2% auto;
            }

            .failed-conversation-details-modal .conversation-details,
            .failed-conversation-details-modal .conversation-messages {
                padding: 15px;
            }
        }

        /* LINE Bot 設定樣式 - 優化版 */
        .form-section {
            margin: 20px 0;
            padding: 20px;
            background: rgba(26, 31, 58, 0.6);
            border-radius: 12px;
            border: 1px solid #2D3555;
            backdrop-filter: blur(10px);
        }

        .section-title {
            color: #E5E7EB;
            font-size: 1.2rem;
            font-weight: 600;
            margin: 0 0 15px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            font-weight: 500;
            color: #E5E7EB;
            margin-bottom: 8px;
            padding: 8px 12px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .checkbox-label:hover {
            background: rgba(139, 92, 246, 0.1);
        }

        .checkbox-label input[type="checkbox"] {
            display: none;
        }

        .checkmark {
            width: 18px;
            height: 18px;
            border: 2px solid rgba(255, 255, 255, 0.4);
            border-radius: 4px;
            position: relative;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.05);
            flex-shrink: 0;
        }

        .checkbox-label input[type="checkbox"]:checked+.checkmark {
            background: #8B5CF6;
            border-color: #8B5CF6;
            box-shadow: 0 2px 8px rgba(139, 92, 246, 0.3);
        }

        .checkbox-label input[type="checkbox"]:checked+.checkmark::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 11px;
            font-weight: bold;
        }

        .line-bot-settings {
            margin-top: 15px;
            padding: 18px;
            background: rgba(26, 31, 58, 0.4);
            border-radius: 10px;
            border: 1px solid #2D3555;
            animation: slideDown 0.3s ease;
        }

        .line-bot-settings .form-group {
            margin-bottom: 15px;
        }

        .line-bot-settings .form-group:last-child {
            margin-bottom: 0;
        }

        .line-bot-settings label {
            font-size: 0.9rem;
            font-weight: 500;
            color: #94A3B8;
            margin-bottom: 6px;
            display: block;
        }

        .line-bot-settings input,
        .line-bot-settings textarea {
            width: 100%;
            padding: 10px 12px;
            background: rgba(26, 31, 58, 0.6);
            border: 1px solid #2D3555;
            border-radius: 6px;
            color: #E5E7EB;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .line-bot-settings input:focus,
        .line-bot-settings textarea:focus {
            outline: none;
            border-color: #8B5CF6;
            background: rgba(26, 31, 58, 0.8);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }

        .line-bot-settings input::placeholder,
        .line-bot-settings textarea::placeholder {
            color: #6B7280;
        }

        .line-bot-settings small {
            color: #94A3B8;
            font-size: 0.85rem;
            margin-top: 4px;
            display: block;
            font-weight: 500;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .line-bot-info {
            margin-top: 20px;
            padding: 20px;
            background: rgba(26, 31, 58, 0.6);
            border-radius: 8px;
            border: 1px solid #2D3555;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .line-bot-info.collapsed {
            max-height: 60px;
            overflow: hidden;
            padding: 15px 20px;
        }

        .line-bot-info.collapsed .setup-steps,
        .line-bot-info.collapsed .quick-tips {
            display: none;
        }

        .line-bot-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            user-select: none;
            margin-bottom: 15px;
        }

        .line-bot-toggle:hover {
            background: rgba(139, 92, 246, 0.1);
            border-radius: 6px;
            padding: 4px 8px;
            margin: -4px -8px 11px -8px;
        }

        .line-bot-toggle-icon {
            font-size: 14px;
            color: #A78BFA;
            transition: transform 0.3s ease;
        }

        .line-bot-info.collapsed .line-bot-toggle-icon {
            transform: rotate(-90deg);
        }

        .line-bot-info h4 {
            color: #E5E7EB;
            margin: 0 0 15px 0;
            font-size: 1rem;
            font-weight: 600;
        }

        .setup-steps {
            margin-bottom: 15px;
        }

        .step {
            display: flex;
            margin-bottom: 15px;
            align-items: flex-start;
        }

        .step-number {
            background: #8B5CF6;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
        }

        .step-content h5 {
            color: #E5E7EB;
            margin: 0 0 6px 0;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .step-content p {
            color: #94A3B8;
            margin: 0 0 6px 0;
            line-height: 1.4;
            font-size: 0.85rem;
        }

        .step-content ul {
            color: #94A3B8;
            margin: 8px 0;
            padding-left: 20px;
        }

        .step-content li {
            margin-bottom: 4px;
        }

        .webhook-url-container {
            margin-top: 12px;
            padding: 12px;
            background: rgba(139, 92, 246, 0.1);
            border-radius: 6px;
            border: 1px solid rgba(139, 92, 246, 0.3);
        }

        .webhook-url-container label {
            color: #94A3B8;
            font-weight: 600;
            display: block;
            margin-bottom: 6px;
            font-size: 0.85rem;
        }

        .url-input-group {
            display: flex;
            gap: 8px;
            margin-bottom: 6px;
        }

        .webhook-url-input {
            flex: 1;
            padding: 8px 10px;
            background: rgba(26, 31, 58, 0.6);
            border: 1px solid #2D3555;
            border-radius: 4px;
            color: #E5E7EB;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
        }

        .webhook-url-input:focus {
            outline: none;
            border-color: #8B5CF6;
            background: rgba(26, 31, 58, 0.8);
        }

        .copy-btn {
            padding: 8px 12px;
            background: #8B5CF6;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.8rem;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .copy-btn:hover {
            background: #7C3AED;
            transform: translateY(-1px);
        }

        .url-note {
            color: #94A3B8;
            font-size: 0.8rem;
            font-style: italic;
        }

        .quick-tips {
            background: rgba(139, 92, 246, 0.1);
            padding: 12px;
            border-radius: 6px;
            border: 1px solid rgba(139, 92, 246, 0.3);
        }

        .quick-tips h5 {
            color: #E5E7EB;
            margin: 0 0 8px 0;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .quick-tips ul {
            color: #94A3B8;
            margin: 0;
            padding-left: 16px;
        }

        .quick-tips li {
            margin-bottom: 4px;
            font-size: 0.8rem;
            line-height: 1.4;
        }

        .external-link {
            color: #A78BFA;
            text-decoration: none;
            font-weight: 500;
        }

        .external-link:hover {
            text-decoration: underline;
            color: #C4B5FD;
        }

        /* 對話入口網址樣式 */
        .url-input-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .url-input-group input {
            flex: 1;
            margin: 0;
        }

        .copy-url-btn,
        .open-url-btn {
            background: #8B5CF6;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            min-width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .copy-url-btn:hover,
        .open-url-btn:hover {
            background: #7C3AED;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }

        .copy-url-btn:active,
        .open-url-btn:active {
            transform: translateY(0);
        }

        /* 代理卡片中的對話入口網址 */
        .agent-chat-url {
            margin: 0.625rem 0;
            padding: 0.75rem;
            background: rgba(139, 92, 246, 0.1);
            border-radius: 0.5rem;
            border: 1px solid var(--border-dark);
        }

        .chat-url-label {
            font-size: 0.75rem;
            color: var(--primary-light);
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .chat-url-container {
            display: flex;
            gap: 0.375rem;
            align-items: center;
        }

        .chat-url-input {
            flex: 1;
            padding: 0.375rem 0.625rem;
            border: 1px solid var(--border-dark);
            border-radius: 0.375rem;
            background: rgba(255, 255, 255, 0.05);
            font-size: 0.75rem;
            color: #E5E7EB;
        }

        .chat-url-input:focus {
            outline: none;
            border-color: var(--primary-base);
            background: rgba(255, 255, 255, 0.08);
        }

        .chat-url-copy-btn,
        .chat-url-open-btn {
            background: var(--primary-base);
            color: white;
            border: none;
            border-radius: 0.375rem;
            padding: 0.375rem 0.5rem;
            cursor: pointer;
            font-size: 0.75rem;
            transition: all 0.3s ease;
            min-width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chat-url-copy-btn:hover,
        .chat-url-open-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        /* 代理卡片中的 LINE Bot 狀態 */
        .agent-line-status {
            display: flex;
            align-items: center;
            gap: 0.625rem;
            margin-top: 0.625rem;
            padding: 0.75rem 0.875rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.625rem;
            border: 1px solid var(--border-dark);
            transition: all 0.3s ease;
        }

        .agent-line-status.enabled {
            background: rgba(16, 185, 129, 0.15);
            border-color: #10b981;
        }

        .agent-line-status.disabled {
            background: rgba(239, 68, 68, 0.15);
            border-color: #ef4444;
        }

        .line-status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
        }

        .line-status-indicator.disabled {
            background: #6b7280;
        }

        .line-status-icon {
            font-size: 1.125rem;
            width: 24px;
            height: 24px;
            text-align: center;
            line-height: 24px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            flex-shrink: 0;
        }

        .line-status-icon.enabled {
            background: rgba(16, 185, 129, 0.3);
            color: #10b981;
        }

        .line-status-icon.disabled {
            background: rgba(239, 68, 68, 0.3);
            color: #ef4444;
        }

        .line-status-text {
            font-size: 0.95rem;
            color: #E5E7EB;
            font-weight: 600;
            flex: 1;
        }

        .line-status-text.enabled {
            color: #10b981;
        }

        .line-status-text.disabled {
            color: #ef4444;
        }

        .line-status-badge {
            padding: 0.25rem 0.625rem;
            border-radius: 0.75rem;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            flex-shrink: 0;
        }

        .line-status-badge.enabled {
            background: rgba(16, 185, 129, 0.3);
            color: #10b981;
        }

        .line-status-badge.disabled {
            background: rgba(239, 68, 68, 0.3);
            color: #ef4444;
        }

        /* 響應式設計 */
        @media (max-width: 768px) {
            .form-section {
                padding: 20px 15px;
            }

            .line-bot-settings {
                padding: 15px;
            }

            .line-bot-info {
                padding: 15px;
            }
        }
    </style>
</head>

<body class="font-display" style="margin: 0; padding: 0; overflow: hidden;">
    <div class="relative flex h-screen w-full">
        <aside class="w-64 border-r border-border-light dark:border-border-dark flex-col hidden lg:flex"
            style="background: linear-gradient(180deg, #1A1F3A 0%, #0F1429 100%);">
            <div
                class="flex h-16 shrink-0 items-center gap-3 border-b border-border-light dark:border-border-dark px-6">
                <div class="text-primary-light">
                    <span class="material-symbols-outlined !text-3xl !font-normal">hub</span>
                </div>
                <h2 class="text-lg font-bold text-gray-50">STU TechPlay</h2>
            </div>
            <nav class="flex-1 space-y-2 p-4">
                <a class="tab flex items-center gap-3 rounded-lg bg-primary/20 px-3 py-2 text-sm font-semibold text-primary-light active"
                    onclick="switchTab('dashboard', this)" href="#">
                    <span class="material-symbols-outlined text-xl">dashboard</span>
                    <span>儀表板</span>
                </a>
                <a class="tab flex items-center gap-3 rounded-lg px-3 py-2 text-sm font-medium text-muted-dark hover:bg-gray-100 dark:hover:bg-primary/10 dark:hover:text-primary-light"
                    onclick="switchTab('agents', this)" href="#">
                    <span class="material-symbols-outlined text-xl">smart_toy</span>
                    <span>代理管理</span>
                </a>
                <a class="tab flex items-center gap-3 rounded-lg px-3 py-2 text-sm font-medium text-muted-dark hover:bg-gray-100 dark:hover:bg-primary/10 dark:hover:text-primary-light"
                    onclick="switchTab('linebot-analytics', this)" href="#">
                    <span class="material-symbols-outlined text-xl">analytics</span>
                    <span>LINE Bot 分析</span>
                </a>
                <a class="tab flex items-center gap-3 rounded-lg px-3 py-2 text-sm font-medium text-muted-dark hover:bg-gray-100 dark:hover:bg-primary/10 dark:hover:text-primary-light"
                    onclick="switchTab('create', this)" href="#">
                    <span class="material-symbols-outlined text-xl">add_circle</span>
                    <span>建立代理</span>
                </a>
                <a class="tab flex items-center gap-3 rounded-lg px-3 py-2 text-sm font-medium text-muted-dark hover:bg-gray-100 dark:hover:bg-primary/10 dark:hover:text-primary-light"
                    onclick="switchTab('profiles', this)" href="#">
                    <span class="material-symbols-outlined text-xl">people</span>
                    <span>人物誌分析</span>
                </a>
                <a class="tab flex items-center gap-3 rounded-lg px-3 py-2 text-sm font-medium text-muted-dark hover:bg-gray-100 dark:hover:bg-primary/10 dark:hover:text-primary-light"
                    onclick="switchTab('notifications', this)" href="#">
                    <span class="material-symbols-outlined text-xl">notifications</span>
                    <span>通知管理</span>
                </a>
                <a class="tab flex items-center gap-3 rounded-lg px-3 py-2 text-sm font-medium text-muted-dark hover:bg-gray-100 dark:hover:bg-primary/10 dark:hover:text-primary-light"
                    onclick="switchTab('user-management', this)" href="#">
                    <span class="material-symbols-outlined text-xl">admin_panel_settings</span>
                    <span>用戶管理</span>
                </a>
            </nav>
        </aside>
        <div class="flex flex-1 flex-col">
            <header
                class="flex h-16 shrink-0 items-center justify-between border-b border-border-light dark:border-border-dark px-6 sticky top-0 z-10 backdrop-blur-sm"
                style="background-color: rgba(26, 31, 58, 0.8);">
                <div class="flex items-center gap-4">
                    <button class="lg:hidden -ml-2 p-2 text-muted-dark hover:text-white transition-colors"
                        onclick="toggleSidebar()">
                        <span class="material-symbols-outlined text-2xl">menu</span>
                    </button>
                    <div>
                        <h1 class="text-xl font-semibold text-gray-50" id="pageTitle">儀表板</h1>
                        <p class="text-xs text-muted-dark flex items-center gap-1">
                            具備 RAG 技術增強的代理人管理系統 | <a href="about.html"
                                class="text-primary-light hover:underline font-bold">了解 RAG 原理</a>
                        </p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <button class="text-muted-dark hover:text-white transition-colors" onclick="refreshAgentsCache()"
                        title="重新整理代理資料">
                        <span class="material-symbols-outlined">refresh</span>
                    </button>
                    <button class="text-muted-dark hover:text-white transition-colors">
                        <span class="material-symbols-outlined">notifications</span>
                    </button>
                    <!-- 代理過濾切換（僅管理員可見） -->
                    <div id="agentFilterToggle" style="display: none;" class="flex items-center gap-2">
                        <button onclick="toggleAgentFilter()"
                            class="flex items-center gap-2 px-3 py-1.5 rounded-lg border border-border-dark bg-card-dark hover:bg-white/10 transition-colors text-sm text-gray-50">
                            <span class="material-symbols-outlined text-base" id="filterIcon">filter_alt</span>
                            <span id="filterText">我的代理</span>
                        </button>
                    </div>
                    <div id="userInfo" style="display: none;" class="relative">
                        <button id="userAvatarBtn"
                            class="aspect-square size-9 rounded-full bg-cover bg-center border-2 border-border-dark hover:border-primary-light transition-colors cursor-pointer flex items-center justify-center"
                            style="background-image: url('');" onclick="toggleUserMenu()"></button>
                        <div id="userMenu"
                            class="hidden absolute right-0 mt-2 w-48 rounded-lg border border-border-dark bg-card-dark shadow-lg z-50">
                            <div class="p-3 border-b border-border-dark">
                                <p id="userName" class="text-sm font-medium text-gray-50"></p>
                                <p id="userEmail" class="text-xs text-muted-dark mt-1"></p>
                            </div>
                            <button id="logoutBtn"
                                class="w-full text-left px-3 py-2 text-sm text-gray-50 hover:bg-white/10 transition-colors">登出</button>
                        </div>
                    </div>
                    <div id="loginSection" style="display: none;">
                        <div id="g_id_onload" data-client_id="YOUR_GOOGLE_OAUTH_CLIENT_ID"
                            data-callback="handleCredentialResponse" data-auto_prompt="false">
                        </div>
                        <div class="g_id_signin" data-type="standard" data-size="large" data-theme="outline"
                            data-text="sign_in_with" data-shape="rectangular" data-logo_alignment="left">
                        </div>
                    </div>
                </div>
            </header>
            <main class="flex-1 p-6 md:p-8 overflow-auto"
                style="background: linear-gradient(135deg, #0A0E27 0%, #1A1F3A 50%, #0F1429 100%);">
                <div class="main-content">

                    <!-- 儀表板 -->
                    <div id="dashboard" class="tab-content active">
                        <div class="flex flex-col gap-8">
                            <!-- System Management Guide -->
                            <section class="reveal">
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
                                    <div
                                        class="bg-card-dark/40 backdrop-blur-md p-4 rounded-xl border border-white/10 hover:border-purple-500/30 transition-all group">
                                        <div
                                            class="size-10 rounded-lg bg-purple-500/20 flex items-center justify-center text-purple-400 mb-3 group-hover:scale-110 transition-transform">
                                            <span class="material-symbols-outlined">smart_toy</span>
                                        </div>
                                        <h4 class="text-white font-bold text-sm mb-1">代理管理</h4>
                                        <p class="text-xs text-gray-400 leading-relaxed">建立並配置 AI 代理，設定行為準則與角色性格。</p>
                                    </div>
                                    <div
                                        class="bg-card-dark/40 backdrop-blur-md p-4 rounded-xl border border-white/10 hover:border-blue-500/30 transition-all group">
                                        <div
                                            class="size-10 rounded-lg bg-blue-500/20 flex items-center justify-center text-blue-400 mb-3 group-hover:scale-110 transition-transform">
                                            <span class="material-symbols-outlined">database</span>
                                        </div>
                                        <h4 class="text-white font-bold text-sm mb-1">知識庫 (RAG)</h4>
                                        <p class="text-xs text-gray-400 leading-relaxed">上傳文檔，AI 將透過 <a
                                                href="about.html" class="text-blue-400 hover:underline">RAG 技術</a> 進行檢索。
                                        </p>
                                    </div>
                                    <div
                                        class="bg-card-dark/40 backdrop-blur-md p-4 rounded-xl border border-white/10 hover:border-emerald-500/30 transition-all group">
                                        <div
                                            class="size-10 rounded-lg bg-emerald-500/20 flex items-center justify-center text-emerald-400 mb-3 group-hover:scale-110 transition-transform">
                                            <span class="material-symbols-outlined">badge</span>
                                        </div>
                                        <h4 class="text-white font-bold text-sm mb-1">人物誌分析</h4>
                                        <p class="text-xs text-gray-400 leading-relaxed">自動分析對話細節，追蹤用戶輪廓與服務品質。</p>
                                    </div>
                                    <div
                                        class="bg-card-dark/40 backdrop-blur-md p-4 rounded-xl border border-white/10 hover:border-amber-500/30 transition-all group">
                                        <div
                                            class="size-10 rounded-lg bg-amber-500/20 flex items-center justify-center text-amber-400 mb-3 group-hover:scale-110 transition-transform">
                                            <span class="material-symbols-outlined">monitoring</span>
                                        </div>
                                        <h4 class="text-white font-bold text-sm mb-1">Token 統計</h4>
                                        <p class="text-xs text-gray-400 leading-relaxed">即時監控 API 使用量與成本，掌握系統負載。</p>
                                    </div>
                                    <div
                                        class="bg-card-dark/40 backdrop-blur-md p-4 rounded-xl border border-white/10 hover:border-pink-500/30 transition-all group">
                                        <div
                                            class="size-10 rounded-lg bg-pink-500/20 flex items-center justify-center text-pink-400 mb-3 group-hover:scale-110 transition-transform">
                                            <span class="material-symbols-outlined">forum</span>
                                        </div>
                                        <h4 class="text-white font-bold text-sm mb-1">LINE 整合</h4>
                                        <p class="text-xs text-gray-400 leading-relaxed">一鍵生成 Webhook，與 LINE 官方帳號無縫接軌。
                                        </p>
                                    </div>
                                </div>
                            </section>
                            <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4">
                                <div class="relative overflow-hidden rounded-xl border border-border-light dark:border-border-dark p-6 shadow-sm"
                                    style="background: rgba(26, 31, 58, 0.8); backdrop-filter: blur(10px);">
                                    <div
                                        class="absolute -top-1 -right-1 size-20 bg-gradient-to-bl from-primary/50 to-transparent opacity-20 blur-2xl">
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <h3 class="text-sm font-medium text-muted-dark">總代理數</h3>
                                        <span class="material-symbols-outlined text-primary-light">smart_toy</span>
                                    </div>
                                    <p class="mt-2 text-3xl font-bold text-gray-50" id="totalAgents">0</p>
                                    <p class="mt-1 text-xs text-muted-dark" id="totalAgentsChange">載入中...</p>
                                </div>
                                <div class="relative overflow-hidden rounded-xl border border-border-light dark:border-border-dark p-6 shadow-sm"
                                    style="background: rgba(26, 31, 58, 0.8); backdrop-filter: blur(10px);">
                                    <div
                                        class="absolute -top-1 -right-1 size-20 bg-gradient-to-bl from-primary/50 to-transparent opacity-20 blur-2xl">
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <h3 class="text-sm font-medium text-muted-dark">總對話數</h3>
                                        <span class="material-symbols-outlined text-primary-light">forum</span>
                                    </div>
                                    <p class="mt-2 text-3xl font-bold text-gray-50" id="totalConversations">0</p>
                                    <p class="mt-1 text-xs text-muted-dark">今天: <span id="todayConversations">0</span> |
                                        昨天: <span id="yesterdayConversations">0</span></p>
                                </div>
                                <div class="relative overflow-hidden rounded-xl border border-border-light dark:border-border-dark p-6 shadow-sm"
                                    style="background: rgba(26, 31, 58, 0.8); backdrop-filter: blur(10px);">
                                    <div
                                        class="absolute -top-1 -right-1 size-20 bg-gradient-to-bl from-primary/50 to-transparent opacity-20 blur-2xl">
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <h3 class="text-sm font-medium text-muted-dark">Token 使用量</h3>
                                        <span class="material-symbols-outlined text-primary-light">task_alt</span>
                                    </div>
                                    <p class="mt-2 text-3xl font-bold text-gray-50" id="totalTokens">0</p>
                                    <p class="mt-1 text-xs text-muted-dark">今日: <span id="todayTokens">0</span> | 總請求:
                                        <span id="totalRequests">0</span>
                                    </p>
                                </div>
                                <div class="relative overflow-hidden rounded-xl border border-border-light dark:border-border-dark p-6 shadow-sm"
                                    style="background: rgba(26, 31, 58, 0.8); backdrop-filter: blur(10px);">
                                    <div
                                        class="absolute -top-1 -right-1 size-20 bg-gradient-to-bl from-primary/50 to-transparent opacity-20 blur-2xl">
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <h3 class="text-sm font-medium text-muted-dark">LINE Bot 用戶</h3>
                                        <span class="material-symbols-outlined text-primary-light">timer</span>
                                    </div>
                                    <p class="mt-2 text-3xl font-bold text-gray-50" id="totalLineBotUsers">0</p>
                                    <p class="mt-1 text-xs text-muted-dark">今日訊息: <span
                                            id="todayLineBotMessages">0</span> | 總訊息: <span
                                            id="totalLineBotMessages">0</span></p>
                                </div>
                            </div>
                            <div class="rounded-xl border border-border-light dark:border-border-dark"
                                style="background: rgba(26, 31, 58, 0.8); backdrop-filter: blur(10px);">
                                <div class="flex items-center justify-between p-6">
                                    <div>
                                        <h2 class="text-lg font-semibold text-gray-50">代理概覽</h2>
                                        <p class="mt-1 text-sm text-muted-dark">管理您的客服代理</p>
                                    </div>
                                    <button onclick="switchTab('create')"
                                        class="flex h-10 cursor-pointer items-center justify-center gap-2 overflow-hidden rounded-lg bg-primary px-4 text-sm font-medium text-primary-foreground shadow-sm transition-colors hover:bg-primary-dark focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary-light focus-visible:ring-offset-2 focus-visible:ring-offset-background-dark">
                                        <span class="material-symbols-outlined text-lg">add_circle</span>
                                        <span>建立代理</span>
                                    </button>
                                </div>
                                <div class="overflow-x-auto">
                                    <table
                                        class="min-w-full divide-y divide-border-light dark:divide-border-dark text-sm">
                                        <thead class="bg-gray-50 dark:bg-white/5">
                                            <tr>
                                                <th class="px-6 py-3 text-left font-medium text-muted-dark" scope="col">
                                                    代理名稱</th>
                                                <th class="px-6 py-3 text-left font-medium text-muted-dark" scope="col">
                                                    狀態</th>
                                                <th class="px-6 py-3 text-left font-medium text-muted-dark" scope="col">
                                                    對話數</th>
                                                <th class="px-6 py-3 text-left font-medium text-muted-dark" scope="col">
                                                    知識庫</th>
                                                <th class="px-6 py-3 text-left font-medium text-muted-dark" scope="col">
                                                    最後更新</th>
                                                <th class="px-6 py-3" scope="col"><span class="sr-only">操作</span></th>
                                            </tr>
                                        </thead>
                                        <tbody id="dashboardAgentsTableBody"
                                            class="divide-y divide-border-light dark:divide-border-dark">
                                            <tr>
                                                <td colspan="6" class="px-6 py-4 text-center text-muted-dark">載入中...
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 代理管理 -->
                    <div id="agents" class="tab-content">
                        <div class="flex flex-col gap-6">
                            <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
                                <div>
                                    <h2 class="text-2xl font-bold tracking-tight text-gray-50">代理管理</h2>
                                    <p class="text-muted-dark mt-1">管理您的 AI 客服代理</p>
                                </div>
                                <button onclick="switchTab('create')"
                                    class="flex items-center gap-2 rounded-lg bg-gradient-to-br from-[#8E2DE2] to-[#4A00E0] px-4 py-2.5 text-sm font-semibold text-white shadow-md hover:opacity-90 transition-opacity">
                                    <span class="material-symbols-outlined text-xl">add</span>
                                    建立代理
                                </button>
                            </div>

                            <div class="grid grid-cols-1 lg:grid-cols-2 2xl:grid-cols-3 gap-6" id="agentsList">
                                <div class="text-center py-12 px-4 text-muted-dark col-span-full">載入中...</div>
                            </div>
                        </div>
                    </div>

                    <!-- LINE Bot 分析 -->
                    <div id="linebot-analytics" class="tab-content">
                        <div class="flex flex-col gap-6">
                            <div class="flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4">
                                <h2 class="text-2xl font-bold tracking-tight text-gray-50">LINE Bot 用戶行為分析</h2>
                                <div class="w-full sm:w-auto flex-1 sm:flex-none sm:min-w-[200px] relative">
                                    <span
                                        class="material-symbols-outlined !text-xl absolute left-3 top-1/2 -translate-y-1/2 text-muted-dark pointer-events-none">support_agent</span>
                                    <select id="linebotAgentSelect" onchange="loadLineBotAnalytics()"
                                        class="w-full rounded-lg border-2 border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark text-sm font-medium text-gray-50 focus:border-primary focus:ring-primary pl-10">
                                        <option value="">請選擇代理...</option>
                                    </select>
                                </div>
                            </div>

                            <div id="linebotAnalyticsContent" class="grid grid-cols-1 gap-6 xl:grid-cols-3">
                                <div
                                    class="analytics-placeholder xl:col-span-3 text-center py-12 px-4 rounded-xl border border-border-light dark:border-border-dark bg-card-light dark:bg-card-dark">
                                    <p class="text-muted-dark">請選擇一個代理來查看 LINE Bot 用戶行為分析</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 建立代理 -->
                    <div id="create" class="tab-content">
                        <div class="rounded-xl border border-border-light dark:border-border-dark p-6 md:p-8"
                            style="background: rgba(26, 31, 58, 0.6); backdrop-filter: blur(10px);">
                            <form id="agentForm">
                                <div class="form-group">
                                    <label for="agentName">代理名稱 *</label>
                                    <input type="text" id="agentName" required>
                                </div>

                                <div class="form-group">
                                    <label for="agentDescription">System Prompt *</label>
                                    <textarea id="agentDescription" required
                                        placeholder="設定 AI 代理的系統提示詞，定義其角色、行為和回應風格..."></textarea>
                                </div>

                                <div class="form-group">
                                    <label for="avatarImageUrl">頭像圖片 URL</label>
                                    <input type="url" id="avatarImageUrl" placeholder="https://example.com/avatar.jpg">
                                    <small>可選：設定 AI 客服的頭像圖片，建議使用正方形圖片</small>
                                </div>

                                <div class="form-group">
                                    <label>知識庫管理 *</label>
                                    <div class="knowledge-base-manager">
                                        <div class="knowledge-base-list" id="knowledgeBaseList">
                                            <!-- 知識庫項目將在這裡動態生成 -->
                                        </div>
                                        <div class="knowledge-base-actions">
                                            <button type="button" class="btn btn-secondary"
                                                onclick="addKnowledgeBase()">+ 新增知識庫</button>
                                            <button type="button" class="btn btn-secondary"
                                                onclick="importFromConversation()">📝 從對話匯入</button>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="llmProvider">LLM 提供商 *</label>
                                    <select id="llmProvider" required onchange="toggleCustomUrl()">
                                        <option value="openai">OpenAI (GPT-4o)</option>
                                        <option value="gemini">Google Gemini (Flash Lite)</option>
                                        <option value="custom">自訂 API</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="apiKey">API Key *</label>
                                    <input type="password" id="apiKey" required>
                                </div>

                                <div class="form-group" id="customUrlGroup" style="display: none;">
                                    <label for="customUrl">自訂 API URL</label>
                                    <input type="url" id="customUrl"
                                        placeholder="https://your-api-endpoint.com/v1/chat/completions">
                                </div>

                                <!-- LINE Bot 設定區域 -->
                                <div class="form-section">
                                    <h3 class="section-title">📱 LINE Bot 設定</h3>
                                    <div class="form-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="enableLineBot"
                                                onchange="toggleLineBotSettings()">
                                            <span class="checkmark"></span>
                                            啟用 LINE Bot 整合
                                        </label>
                                        <small style="display: block; margin-top: 5px;">
                                            啟用後，此代理將可以透過 LINE Bot 與用戶互動
                                        </small>
                                    </div>

                                    <div id="lineBotSettings" class="line-bot-settings" style="display: none;">
                                        <div class="form-group">
                                            <label for="lineChannelId">LINE Channel ID *</label>
                                            <input type="text" id="lineChannelId" placeholder="1234567890">
                                            <small>從 LINE Developers Console 獲取</small>
                                        </div>

                                        <div class="form-group">
                                            <label for="lineChannelSecret">LINE Channel Secret *</label>
                                            <input type="password" id="lineChannelSecret"
                                                placeholder="your-channel-secret">
                                            <small>從 LINE Developers Console 獲取</small>
                                        </div>

                                        <div class="form-group">
                                            <label for="lineAccessToken">LINE Access Token *</label>
                                            <input type="password" id="lineAccessToken" placeholder="your-access-token">
                                            <small>從 LINE Developers Console 獲取</small>
                                        </div>

                                        <div class="form-group">
                                            <label for="chatUrl">LINE 官方對話入口</label>
                                            <div class="url-input-group">
                                                <input type="url" id="chatUrl" placeholder="輸入LINE官方聊天管理網址">
                                                <button type="button" class="copy-url-btn" onclick="copyChatUrl()"
                                                    title="複製網址">
                                                    📋
                                                </button>
                                                <button type="button" class="open-url-btn" onclick="openChatUrl()"
                                                    title="開啟對話">
                                                    🔗
                                                </button>
                                            </div>
                                            <small>輸入 LINE 官方聊天管理網址或自訂對話入口網址</small>
                                        </div>

                                        <div class="form-group">
                                            <label for="lineWelcomeMessage">歡迎訊息</label>
                                            <textarea id="lineWelcomeMessage" placeholder="歡迎使用 AI 客服！有什麼可以幫助您的嗎？"
                                                rows="3"></textarea>
                                            <small>用戶首次關注時顯示的訊息</small>
                                        </div>

                                        <div class="form-group">
                                            <label for="lineFallbackMessage">備用訊息</label>
                                            <textarea id="lineFallbackMessage" placeholder="抱歉，我無法理解您的問題。請嘗試重新描述您的需求。"
                                                rows="3"></textarea>
                                            <small>當 AI 無法回應時顯示的訊息</small>
                                        </div>

                                        <div class="line-bot-info collapsed" id="lineBotInfo">
                                            <div class="line-bot-toggle" onclick="toggleLineBotInfo()">
                                                <h4>📋 LINE Bot 設定指南</h4>
                                                <span class="line-bot-toggle-icon">▼</span>
                                            </div>

                                            <div class="setup-steps">
                                                <div class="step">
                                                    <div class="step-number">1</div>
                                                    <div class="step-content">
                                                        <h5>前往 LINE Developers Console</h5>
                                                        <p>點擊 <a href="https://developers.line.biz/" target="_blank"
                                                                class="external-link">LINE Developers Console</a> 開始設定
                                                        </p>
                                                    </div>
                                                </div>

                                                <div class="step">
                                                    <div class="step-number">2</div>
                                                    <div class="step-content">
                                                        <h5>建立 Provider 和 Channel</h5>
                                                        <p>建立新的 Provider，然後選擇 "Messaging API" 類型建立 Channel</p>
                                                    </div>
                                                </div>

                                                <div class="step">
                                                    <div class="step-number">3</div>
                                                    <div class="step-content">
                                                        <h5>複製憑證資訊</h5>
                                                        <p>從 Channel 設定頁面複製以下資訊：</p>
                                                        <ul>
                                                            <li><strong>Channel ID</strong></li>
                                                            <li><strong>Channel Secret</strong></li>
                                                            <li><strong>Access Token</strong></li>
                                                        </ul>
                                                    </div>
                                                </div>

                                                <div class="step">
                                                    <div class="step-number">4</div>
                                                    <div class="step-content">
                                                        <h5>設定 Webhook URL</h5>
                                                        <p>在 Channel 設定頁面的 "Messaging API" 區塊中：</p>
                                                        <div class="webhook-url-container">
                                                            <label>Webhook URL（點擊複製）：</label>
                                                            <div class="url-input-group">
                                                                <input type="text" id="webhookUrlDisplay" readonly
                                                                    class="webhook-url-input" value="">
                                                                <button type="button" class="copy-btn"
                                                                    onclick="copyWebhookUrl()">📋 複製</button>
                                                            </div>
                                                            <small class="url-note">此 URL 會在您建立代理後自動生成</small>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="step">
                                                    <div class="step-number">5</div>
                                                    <div class="step-content">
                                                        <h5>啟用 Webhook</h5>
                                                        <p>勾選 "Use webhook" 選項，然後點擊 "Verify" 測試連接</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="quick-tips">
                                                <h5>💡 快速提示</h5>
                                                <ul>
                                                    <li>確保 Webhook URL 可以從外網訪問</li>
                                                    <li>測試時可以發送訊息到您的 LINE Bot</li>
                                                    <li>如果遇到問題，請檢查 Firebase Functions 日誌</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <button type="submit" class="btn">建立代理</button>
                            </form>
                        </div>
                    </div>

                    <!-- 測試代理 -->
                    <div id="test" class="tab-content">
                        <div class="test-container">
                            <div class="test-header">
                                <h2>AI 代理測試</h2>
                                <p>選擇一個代理並測試其回應效果</p>
                            </div>

                            <div class="test-setup">
                                <div class="form-group">
                                    <label for="testAgentSelect">選擇代理 *</label>
                                    <div class="w-full sm:w-auto flex-1 sm:flex-none sm:min-w-[200px] relative">
                                        <span
                                            class="material-symbols-outlined !text-xl absolute left-3 top-1/2 -translate-y-1/2 text-muted-dark pointer-events-none">support_agent</span>
                                        <select id="testAgentSelect" required onchange="loadTestAgent()"
                                            class="w-full rounded-lg border-2 border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark text-sm font-medium text-gray-50 focus:border-primary focus:ring-primary pl-10">
                                            <option value="">請選擇代理...</option>
                                        </select>
                                    </div>
                                </div>

                                <div id="testAgentInfo" class="agent-info-card" style="display: none;">
                                    <h3 id="testAgentName"></h3>
                                    <p id="testAgentDescription"></p>
                                    <div class="agent-details">
                                        <div class="detail-item">
                                            <strong>LLM 提供商：</strong>
                                            <span id="testAgentProvider"></span>
                                        </div>
                                        <div class="detail-item">
                                            <strong>知識庫長度：</strong>
                                            <span id="testAgentKnowledgeLength"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="test-chat" id="testChat" style="display: none;">
                                <div class="chat-header">
                                    <h3>與 AI 代理對話</h3>
                                    <div class="chat-actions">
                                        <button id="clearChatBtn" class="btn btn-secondary">清空對話</button>
                                        <button id="testWidgetBtn" class="btn btn-primary">測試 Widget</button>
                                    </div>
                                </div>

                                <div class="chat-messages" id="chatMessages">
                                    <div class="welcome-message">
                                        <p>👋 您好！我是您的 AI 客服代理，請輸入您的問題開始對話。</p>
                                    </div>
                                </div>

                                <div class="chat-input-container">
                                    <div class="input-group">
                                        <input type="text" id="testMessageInput" placeholder="輸入您的問題..."
                                            onkeypress="handleTestKeyPress(event)">
                                        <button id="sendTestMessage" class="btn" onclick="sendTestMessage()">發送</button>
                                    </div>
                                    <div class="typing-indicator" id="typingIndicator" style="display: none;">
                                        <div class="typing-dots">
                                            <span></span>
                                            <span></span>
                                            <span></span>
                                        </div>
                                        <span>AI 正在思考...</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Widget 測試區域 -->
                            <div class="widget-test" id="widgetTest" style="display: none;">
                                <div class="widget-test-header">
                                    <h3>Widget 測試</h3>
                                    <p>在下方測試區域中體驗 Widget 的實際效果</p>
                                </div>

                                <div class="widget-test-container">
                                    <div class="widget-test-info">
                                        <h4>測試說明</h4>
                                        <p>下方是一個模擬的網站頁面，Widget 已經嵌入其中。您可以：</p>
                                        <ul>
                                            <li>點擊右下角的 Widget 按鈕開啟聊天</li>
                                            <li>測試與 AI 代理的對話</li>
                                            <li>體驗實際的用戶界面</li>
                                        </ul>
                                    </div>

                                    <div class="widget-test-page">
                                        <div class="mock-website">
                                            <div class="mock-header">
                                                <h2>範例網站</h2>
                                                <p>這是一個模擬的網站頁面，用於測試 Widget 的嵌入效果</p>
                                            </div>
                                            <div class="mock-content">
                                                <h3>產品介紹</h3>
                                                <p>歡迎來到我們的產品展示頁面。如果您有任何問題，請使用右下角的 AI 客服 Widget 與我們聯繫。</p>
                                                <div class="mock-features">
                                                    <div class="feature">
                                                        <h4>功能一</h4>
                                                        <p>這是第一個功能的描述</p>
                                                    </div>
                                                    <div class="feature">
                                                        <h4>功能二</h4>
                                                        <p>這是第二個功能的描述</p>
                                                    </div>
                                                    <div class="feature">
                                                        <h4>功能三</h4>
                                                        <p>這是第三個功能的描述</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Widget 嵌入點 -->
                                        <div id="widgetContainer"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 人物誌分析 -->
                    <div id="profiles" class="tab-content">
                        <div class="flex-1 p-6 md:p-8 flex flex-col gap-6">
                            <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4">
                                <div>
                                    <h2 class="text-2xl font-bold tracking-tight text-gray-50">人物誌分析</h2>
                                    <p class="text-muted-dark mt-1">高效瀏覽和管理所有人物誌的交談紀錄。</p>
                                </div>
                            </div>

                            <!-- 分頁導航 -->
                            <div class="flex items-center gap-1 border-b border-border-light dark:border-border-dark">
                                <button
                                    class="profile-tab-btn active px-4 py-2 text-sm font-medium text-gray-50 border-b-2 border-primary transition-colors"
                                    onclick="switchProfileTab('profiles-list', this)">
                                    <span class="material-symbols-outlined !text-base align-middle mr-2">people</span>
                                    <span>人物誌分析</span>
                                </button>
                                <button
                                    class="profile-tab-btn px-4 py-2 text-sm font-medium text-muted-dark border-b-2 border-transparent hover:text-gray-50 transition-colors"
                                    onclick="switchProfileTab('failed-conversations', this)">
                                    <span
                                        class="material-symbols-outlined !text-base align-middle mr-2">bug_report</span>
                                    <span>查看失敗對話</span>
                                </button>
                                <button
                                    class="profile-tab-btn px-4 py-2 text-sm font-medium text-muted-dark border-b-2 border-transparent hover:text-gray-50 transition-colors"
                                    onclick="switchProfileTab('session-analytics', this)">
                                    <span
                                        class="material-symbols-outlined !text-base align-middle mr-2">monitoring</span>
                                    <span>Session 統計</span>
                                </button>
                            </div>

                            <!-- 人物誌分析分頁 -->
                            <div id="profiles-list" class="profile-tab-content active flex flex-col gap-6">
                                <div
                                    class="flex flex-col sm:flex-row items-center gap-4 p-3 rounded-xl bg-card-light dark:bg-card-dark border border-border-light dark:border-border-dark">
                                    <div class="w-full sm:w-auto flex-1 sm:flex-none sm:min-w-[200px] relative">
                                        <span
                                            class="material-symbols-outlined !text-xl absolute left-3 top-1/2 -translate-y-1/2 text-muted-dark pointer-events-none">support_agent</span>
                                        <select id="profileAgentSelect"
                                            class="w-full rounded-lg border-2 border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark text-sm font-medium text-gray-50 focus:border-primary focus:ring-primary pl-10">
                                            <option value="">請選擇代理...</option>
                                        </select>
                                    </div>
                                    <div class="relative flex-1 w-full sm:w-auto">
                                        <span
                                            class="material-symbols-outlined !text-xl absolute left-3 top-1/2 -translate-y-1/2 text-muted-dark pointer-events-none">search</span>
                                        <input id="profileSearchInput"
                                            class="w-full rounded-lg border-2 border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark text-sm text-white focus:border-primary focus:ring-primary pl-10"
                                            placeholder="搜尋人物誌名稱或摘要..." type="text" oninput="searchProfiles()" />
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <button class="btn-icon" title="重新整理" onclick="refreshProfiles()">
                                            <span class="material-symbols-outlined !text-2xl">refresh</span>
                                        </button>
                                        <button class="btn-icon" title="排序" onclick="toggleSortMenu()">
                                            <span class="material-symbols-outlined !text-2xl">sort</span>
                                        </button>
                                        <button class="btn-icon" title="篩選" onclick="toggleFilterMenu()">
                                            <span class="material-symbols-outlined !text-2xl">filter_list</span>
                                        </button>
                                    </div>
                                </div>

                                <div
                                    class="flex-1 flex flex-col bg-background-light/50 dark:bg-background-dark/50 rounded-xl border border-border-light dark:border-border-dark min-h-[400px]">
                                    <div class="flex-1 overflow-y-auto p-2 pr-1 space-y-1" id="profilesList">
                                        <div class="text-center py-12 px-4 text-muted-dark">請選擇代理並載入人物誌...</div>
                                    </div>
                                    <div id="profilesPagination"></div>
                                </div>
                            </div>

                            <!-- 失敗對話分頁 -->
                            <div id="failed-conversations" class="profile-tab-content flex flex-col gap-6"
                                style="display: none;">
                                <div
                                    class="flex flex-col sm:flex-row items-center gap-4 p-3 rounded-xl bg-card-light dark:bg-card-dark border border-border-light dark:border-border-dark">
                                    <div class="w-full sm:w-auto flex-1 sm:flex-none sm:min-w-[200px] relative">
                                        <span
                                            class="material-symbols-outlined !text-xl absolute left-3 top-1/2 -translate-y-1/2 text-muted-dark pointer-events-none">support_agent</span>
                                        <select id="failedConversationsAgentSelect"
                                            class="w-full rounded-lg border-2 border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark text-sm font-medium text-gray-50 focus:border-primary focus:ring-primary pl-10">
                                            <option value="">請選擇代理...</option>
                                        </select>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <button class="btn-icon" title="重新整理" onclick="refreshFailedConversations()">
                                            <span class="material-symbols-outlined !text-2xl">refresh</span>
                                        </button>
                                    </div>
                                </div>

                                <div
                                    class="flex-1 flex flex-col bg-background-light/50 dark:bg-background-dark/50 rounded-xl border border-border-light dark:border-border-dark min-h-[400px]">
                                    <div class="flex-1 overflow-y-auto p-4" id="failedConversationsList">
                                        <div class="text-center py-12 px-4 text-muted-dark">請選擇代理並載入失敗對話...</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Session 統計分頁 -->
                            <div id="session-analytics" class="profile-tab-content flex flex-col gap-6"
                                style="display: none;">
                                <div
                                    class="flex flex-col sm:flex-row items-center gap-4 p-3 rounded-xl bg-card-light dark:bg-card-dark border border-border-light dark:border-border-dark">
                                    <div class="w-full sm:w-auto flex-1 sm:flex-none sm:min-w-[200px] relative">
                                        <span
                                            class="material-symbols-outlined !text-xl absolute left-3 top-1/2 -translate-y-1/2 text-muted-dark pointer-events-none">support_agent</span>
                                        <select id="sessionAnalyticsAgentSelect"
                                            class="w-full rounded-lg border-2 border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark text-sm font-medium text-gray-50 focus:border-primary focus:ring-primary pl-10">
                                            <option value="">請選擇代理...</option>
                                        </select>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <button class="btn-icon" title="重新整理" onclick="refreshSessionAnalytics()">
                                            <span class="material-symbols-outlined !text-2xl">refresh</span>
                                        </button>
                                    </div>
                                </div>

                                <div
                                    class="flex-1 flex flex-col bg-background-light/50 dark:bg-background-dark/50 rounded-xl border border-border-light dark:border-border-dark min-h-[400px]">
                                    <div class="flex-1 overflow-y-auto p-4" id="sessionAnalyticsContent">
                                        <div class="text-center py-12 px-4 text-muted-dark">請選擇代理並載入 Session 統計...</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 通知管理 -->
                    <div id="notifications" class="tab-content">
                        <div class="test-container">
                            <div class="test-header">
                                <h2>通知管理</h2>
                                <p>查看和管理系統通知，包括知識庫維護需求和聯絡資訊</p>
                            </div>

                            <div class="notification-analysis">
                                <div
                                    class="flex flex-col sm:flex-row items-center gap-4 p-3 rounded-xl bg-card-light dark:bg-card-dark border border-border-light dark:border-border-dark">
                                    <div class="w-full sm:w-auto flex-1 sm:flex-none sm:min-w-[200px] relative">
                                        <span
                                            class="material-symbols-outlined !text-xl absolute left-3 top-1/2 -translate-y-1/2 text-muted-dark pointer-events-none">support_agent</span>
                                        <select id="notificationAgentSelect"
                                            class="w-full rounded-lg border-2 border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark text-sm font-medium text-gray-50 focus:border-primary focus:ring-primary pl-10">
                                            <option value="">請選擇代理...</option>
                                        </select>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <button id="refreshNotificationsBtn" class="btn-icon" title="重新整理"
                                            onclick="refreshNotifications()">
                                            <span class="material-symbols-outlined !text-2xl">refresh</span>
                                        </button>
                                        <button id="markAllReadBtn" class="btn btn-secondary"
                                            onclick="markAllNotificationsRead()">全部標記為已讀</button>
                                    </div>
                                </div>

                                <div id="notificationsList" class="notifications-list">
                                    <div class="loading">請選擇代理並載入通知...</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 用戶管理 -->
                    <div id="user-management" class="tab-content">
                        <div class="flex flex-col gap-6">
                            <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4">
                                <div>
                                    <h2 class="text-2xl font-bold tracking-tight text-gray-50">用戶管理</h2>
                                    <p class="text-muted-dark mt-1">管理用戶角色和權限設定</p>
                                </div>
                            </div>

                            <div class="rounded-xl border border-border-light dark:border-border-dark p-6 md:p-8"
                                style="background: rgba(26, 31, 58, 0.6); backdrop-filter: blur(10px);">
                                <!-- System Management Guide -->
                                <section class="p-6 mb-8 reveal">
                                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
                                        <div
                                            class="glass-card p-4 rounded-xl border border-white/10 hover:border-purple-500/30 transition-all group">
                                            <div
                                                class="size-10 rounded-lg bg-purple-500/20 flex items-center justify-center text-purple-400 mb-3 group-hover:scale-110 transition-transform">
                                                <span class="material-symbols-outlined">smart_toy</span>
                                            </div>
                                            <h4 class="text-white font-bold text-sm mb-1">代理管理</h4>
                                            <p class="text-xs text-gray-500 leading-relaxed">建立並配置多個 AI
                                                代理，設定獨特的行為準則與角色性格。</p>
                                        </div>
                                        <div
                                            class="glass-card p-4 rounded-xl border border-white/10 hover:border-blue-500/30 transition-all group">
                                            <div
                                                class="size-10 rounded-lg bg-blue-500/20 flex items-center justify-center text-blue-400 mb-3 group-hover:scale-110 transition-transform">
                                                <span class="material-symbols-outlined">database</span>
                                            </div>
                                            <h4 class="text-white font-bold text-sm mb-1">知識庫</h4>
                                            <p class="text-xs text-gray-500 leading-relaxed">上傳業務文檔，AI 將透過 RAG
                                                技術進行精準檢索與回答。</p>
                                        </div>
                                        <div
                                            class="glass-card p-4 rounded-xl border border-white/10 hover:border-emerald-500/30 transition-all group">
                                            <div
                                                class="size-10 rounded-lg bg-emerald-500/20 flex items-center justify-center text-emerald-400 mb-3 group-hover:scale-110 transition-transform">
                                                <span class="material-symbols-outlined">badge</span>
                                            </div>
                                            <h4 class="text-white font-bold text-sm mb-1">人物誌分析</h4>
                                            <p class="text-xs text-gray-500 leading-relaxed">自動分析對話細節，追蹤用戶輪廓與需求，提升服務品質。
                                            </p>
                                        </div>
                                        <div
                                            class="glass-card p-4 rounded-xl border border-white/10 hover:border-amber-500/30 transition-all group">
                                            <div
                                                class="size-10 rounded-lg bg-amber-500/20 flex items-center justify-center text-amber-400 mb-3 group-hover:scale-110 transition-transform">
                                                <span class="material-symbols-outlined">monitoring</span>
                                            </div>
                                            <h4 class="text-white font-bold text-sm mb-1">Token 統計</h4>
                                            <p class="text-xs text-gray-500 leading-relaxed">即時監控 API 使用量與成本，掌握系統運作負載情況。
                                            </p>
                                        </div>
                                        <div
                                            class="glass-card p-4 rounded-xl border border-white/10 hover:border-pink-500/30 transition-all group">
                                            <div
                                                class="size-10 rounded-lg bg-pink-500/20 flex items-center justify-center text-pink-400 mb-3 group-hover:scale-110 transition-transform">
                                                <span class="material-symbols-outlined">forum</span>
                                            </div>
                                            <h4 class="text-white font-bold text-sm mb-1">LINE 整合</h4>
                                            <p class="text-xs text-gray-500 leading-relaxed">一鍵生成 Webhook，讓 AI 代理無縫接入
                                                LINE 官方帳號。</p>
                                        </div>
                                    </div>
                                </section>

                                <div class="mb-6">
                                    <h3 class="text-lg font-semibold text-gray-50 mb-4">添加用戶角色</h3>
                                    <p class="text-sm text-muted-dark mb-4">設定用戶的角色。管理員可以查看和管理所有代理，普通用戶只能查看自己創建的代理。</p>

                                    <div
                                        class="flex flex-col sm:flex-row items-center gap-4 p-3 rounded-xl bg-card-light dark:bg-card-dark border border-border-light dark:border-border-dark mb-4">
                                        <div class="w-full sm:w-auto flex-1 sm:flex-none sm:min-w-[200px] relative">
                                            <span
                                                class="material-symbols-outlined !text-xl absolute left-3 top-1/2 -translate-y-1/2 text-muted-dark pointer-events-none">person_search</span>
                                            <input type="email" id="userEmailInput"
                                                class="w-full rounded-lg border-2 border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark text-sm font-medium text-gray-50 focus:border-primary focus:ring-primary pl-10"
                                                placeholder="輸入用戶 Email..." />
                                        </div>
                                        <div class="w-full sm:w-auto flex-1 sm:flex-none sm:min-w-[200px] relative">
                                            <span
                                                class="material-symbols-outlined !text-xl absolute left-3 top-1/2 -translate-y-1/2 text-muted-dark pointer-events-none">badge</span>
                                            <select id="userRoleSelect"
                                                class="w-full rounded-lg border-2 border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark text-sm font-medium text-gray-50 focus:border-primary focus:ring-primary pl-10">
                                                <option value="user">普通用戶</option>
                                                <option value="admin">管理員</option>
                                            </select>
                                        </div>
                                        <button onclick="addUserRole()"
                                            class="flex items-center gap-2 rounded-lg bg-gradient-to-br from-[#8E2DE2] to-[#4A00E0] px-4 py-2.5 text-sm font-semibold text-white shadow-md hover:opacity-90 transition-opacity"
                                            id="addUserBtn">
                                            <span class="material-symbols-outlined text-xl">add</span>
                                            添加用戶
                                        </button>
                                    </div>

                                    <div class="rounded-xl border border-border-light dark:border-border-dark"
                                        style="background: rgba(26, 31, 58, 0.8); backdrop-filter: blur(10px);">
                                        <div class="flex items-center justify-between p-6">
                                            <div>
                                                <h4 class="text-lg font-semibold text-gray-50">用戶列表</h4>
                                                <p class="mt-1 text-sm text-muted-dark">當前系統中的所有用戶及其角色</p>
                                            </div>
                                            <button onclick="loadUserList()" class="btn-icon" title="重新整理">
                                                <span class="material-symbols-outlined !text-2xl">refresh</span>
                                            </button>
                                        </div>
                                        <div class="overflow-x-auto">
                                            <table
                                                class="min-w-full divide-y divide-border-light dark:divide-border-dark text-sm">
                                                <thead class="bg-gray-50 dark:bg-white/5">
                                                    <tr>
                                                        <th class="px-6 py-3 text-left font-medium text-muted-dark"
                                                            scope="col">Email</th>
                                                        <th class="px-6 py-3 text-left font-medium text-muted-dark"
                                                            scope="col">角色</th>
                                                        <th class="px-6 py-3 text-left font-medium text-muted-dark"
                                                            scope="col">用戶 ID</th>
                                                        <th class="px-6 py-3 text-left font-medium text-muted-dark"
                                                            scope="col">設定時間</th>
                                                        <th class="px-6 py-3" scope="col"><span
                                                                class="sr-only">操作</span></th>
                                                    </tr>
                                                </thead>
                                                <tbody id="usersTableBody"
                                                    class="divide-y divide-border-light dark:divide-border-dark">
                                                    <tr>
                                                        <td colspan="5" class="px-6 py-4 text-center text-muted-dark">
                                                            載入中...</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    <script>
        // 切換側邊欄（行動裝置）
        function toggleSidebar() {
            const sidebar = document.querySelector('aside');
            sidebar.classList.toggle('hidden');
        }

        // 更新 switchTab 函數以支援新的導航方式
        const originalSwitchTab = window.switchTab;
        window.switchTab = function (tabName, targetElement = null) {
            // 更新頁面標題
            const titles = {
                'dashboard': '儀表板',
                'agents': '代理管理',
                'linebot-analytics': 'LINE Bot 分析',
                'create': '建立代理',
                'profiles': '人物誌分析',
                'notifications': '通知管理',
                'user-management': '用戶管理'
            };
            // 使用 updatePageTitle 函數來更新標題（包含用戶資訊）
            if (titles[tabName] && typeof updatePageTitle === 'function') {
                updatePageTitle(titles[tabName]);
            } else {
                const pageTitle = document.getElementById('pageTitle');
                if (pageTitle && titles[tabName]) {
                    pageTitle.textContent = titles[tabName];
                }
            }

            // 更新導航項目的 active 狀態
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active', 'bg-primary/20', 'text-primary-light', 'font-semibold');
                tab.classList.add('text-muted-dark', 'font-medium');
            });

            if (targetElement) {
                targetElement.classList.add('active', 'bg-primary/20', 'text-primary-light', 'font-semibold');
                targetElement.classList.remove('text-muted-dark', 'font-medium');
            } else {
                // 如果沒有提供 targetElement，嘗試找到對應的導航項目
                const navItem = document.querySelector(`[onclick*="switchTab('${tabName}'"]`);
                if (navItem) {
                    navItem.classList.add('active', 'bg-primary/20', 'text-primary-light', 'font-semibold');
                    navItem.classList.remove('text-muted-dark', 'font-medium');
                }
            }

            // 調用原始的 switchTab 函數
            if (originalSwitchTab) {
                originalSwitchTab(tabName, targetElement);
            } else {
                // 如果原始函數不存在，執行基本切換
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                const targetContent = document.getElementById(tabName);
                if (targetContent) {
                    targetContent.classList.add('active');
                }
            }

            // 根據分頁載入對應的數據
            if (tabName === 'user-management' && typeof loadUserList === 'function') {
                loadUserList();
            }
        };

        // updateDashboardAgentsTable 函數已移至 admin.js
    </script>
    <script src="admin.js"></script>
</body>

</html>